Session 1: How to Install Splunk Products Like an Ace Student
This lab is designed to take a fresh Linux instance and use Splunk best practices to configure Splunk. We are going to go over connecting to your client via ssh, why you should create a Splunk user, installing Splunk, checking permission and starting your Splunk instance.

Setting Ulimits
Ulimits are settings that exist in Linux that determine how many system resources can be assigned to users and groups. Ulimits configurations are stored in /etc/security/limits.conf. Run the following commands as root to define these settings

sudo su -
Switch directories over to /etc/security

cd /etc/security
If you are running Splunk as the splunk user, add the following to the bottom of limits.conf

vi limits.conf
:$ - This takes you to the bottom of the page
i  - Opens the insert options to alter the file

splunk hard core 0
splunk hard maxlogins 10
splunk soft nofile 65535
splunk hard nofile 65535
splunk soft nproc 20480
splunk hard nproc 20480
splunk soft nfile unlimited
splunk hard nfile unlimited

wq - Saves the changes made to the file
Disabling Transparent Huge Pages (THP)
Add the following to the bottom of /etc/rc.d/rc.local as root

vi /etc/rc.d/rc.local
:$
i

#SPLUNK: disable THP at boot time
 THP=`find /sys/kernel/mm/ -name transparent_hugepage -type d | tail -n
1`
 for SETTING in "enabled" "defrag";do
     if test -f ${THP}/${SETTING}; then
         echo never > ${THP}/${SETTING}
fi done
Make rc.local executable 

chmod +x /etc/rc.d/rc.local
Splunk Set-Up
Connect to your host and install Splunk.

SSH to your host

ssh user@hostname
Change to root user

sudo su -
Install wget and create your splunk user

sudo yum -y install wget
sudo adduser splunk
Change directories to the location where youâ€™ll install Splunk


cd /opt
Use the wget command to install Splunk


wget -O splunk-8.1.7.2-dc318a6952c4-Linux-x86_64.tgz 'https://download.splunk.com/products/splunk/releases/8.1.7.2/linux/splunk-8.1.7.2-dc318a6952c4-Linux-x86_64.tgz'
Unzip your file


sudo tar -xvzf splunk-8.1.7.2-dc318a6952c4-Linux-x86_64.tgz
Assign splunk the proper permissions


sudo chown -R splunk:splunk /opt/splunk
Switch users to splunk

sudo su - splunk
Start Splunk

/opt/splunk/bin/splunk start --accept-license --answer-yes
Enable boot start of Splunk

exit
sudo /opt/splunk/bin/splunk enable boot-start -user splunk
sudo su - splunk
 
Add ulimits and THP settings to the Splunk init.d script
Open the /etc/init.d/splunk file with your text editor and modify it so that below RETVAL=0, there are extra functions to ensure ulimits and THP are set properly. The following reflects what your init file should look like.

#!/bin/sh
     #
     # /etc/init.d/splunk
     # init script for Splunk.
     # generated by 'splunk enable boot-start'.
     #
     # chkconfig: 2345 90 60
     # description: Splunk indexer service
     #
     RETVAL=0
     . /etc/init.d/functions
     # disable hugepages
     disable_huge() {
      echo "disabling huge page support"
      THP=`find /sys/kernel/mm/ -name transparent_hugepage -type d | tail -n
chmod +x /etc/rc.d/rc.local
/opt/splunk/bin/splunk enable boot-start -user splunk
   
   1`
 for SETTING in "enabled" "defrag";do
     if test -f ${THP}/${SETTING}; then
         echo never > ${THP}/${SETTING}
fi done
}
splunk_start() {
  ulimit -Hn 65535
  ulimit -Sn 65535
  ulimit -Hu 20480
  ulimit -Su 20480
  ulimit -Hf unlimited
  ulimit -Sf unlimited
  echo Starting Splunk...
  "/opt/splunk/bin/splunk" start --no-prompt --answer-yes
  RETVAL=$?
  [ $RETVAL -eq 0 ] && touch /var/lock/subsys/splunk
}
splunk_stop() {
  echo Stopping Splunk...
  "/opt/splunk/bin/splunk" stop
  RETVAL=$?
  [ $RETVAL -eq 0 ] && rm -f /var/lock/subsys/splunk
}
splunk_restart() {
  echo Restarting Splunk...
  "/opt/splunk/bin/splunk" restart
  RETVAL=$?
  [ $RETVAL -eq 0 ] && touch /var/lock/subsys/splunk
}
splunk_status() {
  echo Splunk status:
  "/opt/splunk/bin/splunk" status
  RETVAL=$?
}
case "$1" in
start)
   disable_huge
   splunk_start
   ;;
stop)
   splunk_stop
;; restart)
   disable_huge
   splunk_restart
   ;;
status)

   splunk_status
;;

esac
exit $RETVAL
